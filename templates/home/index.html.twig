{% extends 'base.html.twig' %}

{% block title %}Accueil
{% endblock %}

{% block body %}


	<div>
		<h1>Accueil</h1>
	</div>
    	<section>
    <div>
      <h2>Rechercher covoiturage</h2>
    </div>
		{{ form_start(searchForm) }}
		<div>
			{{ form_row(searchForm.date) }}
		</div>
		<div>
			{{ form_row(searchForm.address_start) }}
      		<button onclick="getLocation()">Obtenir la localisation</button>
		</div>
		<div>
			{{ form_row(searchForm.address_end) }}
		</div>
		<button type="submit" class="btn btn-primary">Rechercher</button>
		{{ form_end(searchForm) }}
	</section>
	<div id="geo-output"></div>

{# Reviews website section #}
<section class="review-section border border-warning border-2 container-fluid mt-0 p-4">
	<div class="row">
		<div class="col-lg-4">
			<h2 class="text-start title mt-3">Ce que nos voyageurs disent de nous</h2>
		</div>
		<div class="col-lg-8 mt-3">
			<div
				class="row">
				{# MongoDB reviews #}
				{% for review in reviews %}
					<div class="col-lg-4 col-md-6 mb-4">
						<div class="card border-warning card-visit h-100">
							<div class="card-body text-dark bg-gradient d-flex flex-column">
								<h3 class="fs-5 mb-3">Par
									<strong>{{ review.pseudo }}</strong>
								</h3>
								<div class="border-start border-4 border-warning flex-grow-1">
									<p class="card-text ms-2 fs-5 mb-4 ">"
										{{ review.commentary }}
										"</p>
								</div>

								<div class="mt-3">
									<span class="badge bg-warning text-dark fs-6 py-2 px-3">
										{{ review.rate }}/5</span>
								</div>
								<div id="stars" class="d-flex text-warning py-2 stars">
									<i class="fa-solid fa-star star"></i>
									<i class="fa-solid fa-star star"></i>
									<i class="fa-solid fa-star star"></i>
									<i class="fa-solid fa-star star"></i>
									<i class="fa-solid fa-star star"></i>
								</div>
								<div class="mt-4">
									<span class="fs-6">Posté le
										{{ review.createdAt|date('d/m/Y') }}</span>
								</div>
							</div>
						</div>
					</div>
				{% else %}
					<div class="col-12">
						<div class="card card-visit h-100">
							<div class="card-body text-white bg-primary bg-gradient d-flex flex-column">
								<p class="card-text fs-5">Aucun avis disponible pour l'instant.</p>
							</div>
						</div>
					</div>
				{% endfor %}
			</div>
		</div>
	</div>
</section>
<script>
let x = document.getElementById("geo-output");

function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(success, error);
  } else {
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function success(position) {
  const lat = position.coords.latitude;
  const lon = position.coords.longitude;

  // Appel à l'API Nominatim pour obtenir l'adresse
  fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`)
    .then(response => response.json())
    .then(data => {
      if (data && data.display_name) {
        // Met l'adresse dans l'input
        document.getElementById("search_carpool_form_address_start").value = data.display_name;
        x.innerHTML = ""; // efface le message
      } else {
        x.innerHTML = "Impossible de trouver une adresse.";
      }
    })
    .catch(() => {
      x.innerHTML = "Erreur lors de la récupération de l'adresse.";
    });
}

function error() {
  alert("Désolé, aucune position disponible.");
}
</script>
{% endblock %}